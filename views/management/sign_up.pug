extends ../layout-type01
block style
  link(rel='stylesheet', type='text/css', href='/assets/plugins/datatables/plugins/bootstrap/dataTables.bootstrap.css')
block script
  script(type='text/javascript', src='/assets/plugins/datatables/plugins/bootstrap/dataTables.bootstrap.js')
  script(src='/assets/scripts/page/table-managed.js')
  script.
    $(document).ready(function() {

      $("#register-submit-btn").click(function() {
        if ($("#userid").val() == "") {
          $("#userid").focus();
          $("#register_tnc_error").html("User ID를 입력하세요.");
          $("#register_tnc_error").show();
          return false;
        }
        if ($("#username").val() == "") {
          $("#username").focus();
          $("#register_tnc_error").html("User Name를 입력하세요.");
          $("#register_tnc_error").show();
          return false;
        }
        if ($("#register_password").val() == "") {
          $("#register_password").focus();
          $("#register_tnc_error").html("Password 를 입력하세요.");
          $("#register_tnc_error").show();
          return false;
        } else if ($("#register_password").val() != $("#register_password_1").val()) {
          $("#register_password").focus();
          $("#register_tnc_error").html("Password가 다릅니다. 다시 입력하세요.");
          $("#register_tnc_error").show();
          return false;
        }

        // TODO 메시지 공통 영역으로
        if (confirm("등록 하시겠습니까? ")) {
          var userid = $("#userid").val();
          $.ajax({
            url: "/management/users/" + userid,
            dataType: "json",
            type: "POST",
            data:$('#create_account').serialize(),
            success: function(result) {
              alert('(' + result.rtnCode.code + ')' +result.rtnCode.message);
              if (result.rtnCode.code == "D001") {
                location.href = "/management/users";
              }
            },
            error: function(req, status, err) {

              //- alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
              $("#errormsg").html("code:"+status+"\n"+"message:"+req.responseText+"\n"+"error:"+err);
            }
          });
        }
      });

      $("#userid").keydown(function() {
        $("#register_tnc_error").html("");
        $("#register_tnc_error").hide();
      });
      $("#username").keydown(function() {
        $("#register_tnc_error").html("");
        $("#register_tnc_error").hide();
      });

      var msg = urlParams.msg;
      console.log(urlParams.msg);
      if(msg === "3") {
        alert("이미 등록된 아이디 입니다.");
      } else if(msg === "4") {
        alert("회원가입을 축하합니다~");
      }
      Metronic.init(); // init metronic core componets
      eyelinkLayout.init(); // init eyelinklayout
      Layout.init(); // init layout
      Demo.init(); // init index page
      $.backstretch([
        "assets/images/bg/1.jpg",
        "assets/images/bg/2.jpg",
        "assets/images/bg/3.jpg",
        "assets/images/bg/4.jpg"
        ], {
          fade: 1000,
          duration: 8000
      });
    });
  script.
    var urlParams = location.search.split(/[?&]/).slice(1).map(function(paramPair) {
      return paramPair.split(/=(.+)?/).slice(0, 2);
    }).reduce(function(obj, pairArray) {
      obj[pairArray[0]] = pairArray[1];
      return obj;
    }, {});
block content
  .container-fluid
    .page-content
      .breadcrumbs
        h1 Sign up
        ol.breadcrumb
          li
            a(href='/dashboard') Home
          li
            a(href='#') Management
          li.active Sign up
      .row
        .col-md-12
          .portlet.light
            .portlet-title
              .caption
                span.caption-subject.bold.uppercase.font-green-haze Sign Up
                span.caption-helper Total 8 Users
            .portlet-body
              form#create_account.register-form(onsubmit="return false;")
                p Enter your account details below:
                  .form-group
                    label.control-label.visible-ie8.visible-ie9 User Name
                    .input-icon
                      i.fa.fa-font
                      input#username.form-control.placeholder-no-fix(type='text', placeholder='User Name', name='username')
                  .form-group
                    label.control-label.visible-ie8.visible-ie9 User ID
                    .input-icon
                      i.fa.fa-user
                      input#userid.form-control.placeholder-no-fix(type='text', autocomplete='off', placeholder='User ID', name='userid')
                  .form-group
                    label.control-label.visible-ie8.visible-ie9 Password
                    .input-icon
                      i.fa.fa-lock
                      input#register_password.form-control.placeholder-no-fix(type='password', autocomplete='off', placeholder='Password', name='password')
                  .form-group
                    label.control-label.visible-ie8.visible-ie9 Re-type Your Password
                    .controls
                      .input-icon
                        i.fa.fa-check
                        input#register_password_1.form-control.placeholder-no-fix(type='password', autocomplete='off', placeholder='Re-type Your Password', name='password')
                  .form-group
                    .input-icon
                      i.fa.fa-envelope
                      input.form-control.placeholder-no-fix(type='text', autocomplete='off', placeholder='Email', name='email')
                  .form-group
                    label.control-label.visible-ie8.visible-ie9 User Role
                    select#userrole.select2.form-control(name='userrole')
                      option(value='') User Role
                      option(value='Super Manager') Super Manager
                      option(value='Zone Manager') Zone Manager
                      option(value='Asset Manager') Asset Manager
                      option(value='User') User
                  .form-group
                    label
                      input(type='checkbox', name='tnc')
                      |  I agree to the
                      a(href='javascript:;') Terms of Service
                      |  and
                      a(href='javascript:;') Privacy Policy
                    #register_tnc_error
                  .form-actions
                    button#register-back-btn.btn(type='button' onclick="location.href='./users'")
                      i.m-icon-swapleft
                    button#register-submit-btn.btn.blue.pull-right Sign Up
                      i.m-icon-swapright.m-icon-white
            .portlet-footer
    p.copyright Copyright M2U Technology All rights reserved.
  a.go2top(href='#index')
    i.icon-arrow-up
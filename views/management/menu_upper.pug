extends ../layout-type01
block style
  link(rel='stylesheet', href='/assets/leaflet/leaflet.css')
  link(rel='stylesheet', href='/assets/leaflet/leaflet.markercluster.css')
  link(rel='stylesheet', type='text/css', href='/assets/plugins/datatables/plugins/bootstrap/dataTables.bootstrap.css')
  link(rel='stylesheet', href='/stylesheets/style.css')
block script
  script(type='text/javascript', src="/scripts/util.js")
  script(type='text/javascript', src='/assets/plugins/datatables/media/js/jquery.dataTables.min.js')
  script(type='text/javascript', src='/assets/plugins/datatables/plugins/bootstrap/dataTables.bootstrap.js')
  script(src='/assets/scripts/page/table-managed.js')
  script.
    $(document).ready(function() {
      TableManaged.init();

      $('#btn_add').click(function(){
        //- event.preventDefault();        
        var code =$("#code").val();
        var name = $("#name").val();
        console.log(code , name)
        
        if (code == "") {
          $("#code").focus();
          $("#register_tnc_error").html("Code를 입력하세요.");
          $("#register_tnc_error").show();
          return false;
          }
          if (9999<parseInt($("#code").val())||parseInt($("#code").val())<999) {
            console.log(parseInt($("#code").val()));
            $("#code").focus();
            $("#register_tnc_error").html("Code는 4자리 숫자로 입력하세요");
            $("#register_tnc_error").show();
            return false;
          }
          if (parseInt($("#code").val())%1000 != 0) {
            console.log(parseInt($("#code").val()));
            $("#code").focus();
            $("#register_tnc_error").html("Upper Menu Code는 천의 배수로 입력하세요");
            $("#register_tnc_error").show();
            return false;
          }
          if ($("#name").val() == "") {
            $("#name").focus();
            $("#register_tnc_error").html("Name을 입력하세요.");
            $("#register_tnc_error").show();
            return false;
          }
          if (code == "" || name == "") {
            return false;
          }
        // TODO 메시지 공통 영역으로
        if (confirm("등록 하시겠습니까? ")) {          
          $.ajax({
            url: "/management/menu/" + code,
            dataType: "json",
            type: "POST",
            data: { code : code, name : name, upcode : "0000" },
            success: function(result) {
              alert('(' + result.rtnCode.code + ')' +result.rtnCode.message);
              if (result.rtnCode.code == "D001") {
                location.href = "/management/menu_upper";
              }
            },
            error: function(req, status, err) {
              //- alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
              $("#errormsg").html("code:"+status+"\n"+"message:"+req.responseText+"\n"+"error:"+err);
            }
          });
        }
      });
      $('a').click(function(event){
        //- event.preventDefault();
        if ('deleteMenu' != $(this).attr('flag')) return;        
        var id = $(this).attr('id');
        if (id == "") {
          return false;
        }
        // TODO 메시지 공통 영역으로
        if (confirm("삭제 하시겠습니까? ")) {
          $.ajax({
            url: "/management/menu/" + id,
            dataType: "json",
            type: "DELETE",
            data: {id : id},
            success: function(result) {
              alert('(' + result.rtnCode.code + ')' +result.rtnCode.message);
              if (result.rtnCode.code == "D003") {
                location.href = "/management/menu_upper";
              }
            },
            error: function(req, status, err) {
              //- alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
              $("#errormsg").html("code:"+status+"\n"+"message:"+req.responseText+"\n"+"error:"+err);
            }
          });
        }
      });
    });
block content
  .container-fluid
    .page-content
      .breadcrumbs
        h1 Upper Menu
        ol.breadcrumb
          li
            a(href='#') Home
          li
            a(href='#') Management
          li.active Upper Menu
      .row
        .col-md-12
          .portlet.light.bordered
            .portlet-title
              .caption.font-dark
                span.caption-subject.bold.uppercase.font-blue-sharp Add Upper Menu                
            .portlet-body.form
               form.form-horizontal.form-bordered(onsubmit="return false;")
                .form-body
                  .form-group.last
                    label.control-label.col-md-2 Code
                    .col-md-1.form-inline
                      input#code.form-control(type='text', name='code', value='', data-placeholder='code')   
                    label.control-label.col-md-2 Name
                    .col-md-3.form-inline
                      input#name.form-control(type='text', name='name', value='', data-placeholder='name')                 
                    .col-md-1.form-inline
                      button#btn_add.btn.blue  Add
                  .form-group
                    #register_tnc_error(style='text-align:center;')      
      .row
        .col-md-12
          .portlet.light
            .portlet-title
              .caption
                span.caption-subject.bold.uppercase.font-green-haze Upper Menu List                              
            .portlet-body.form
              table#sample_2.table.table-striped.table-bordered.table-hover(style='text-align:center;')
                thead
                  tr
                    th(style='text-align:center;') 
                    th(style='text-align:center;')  Code
                    th(style='text-align:center;')  Name                  
                    th(style='text-align:center;')  Delete                
                tbody
                  each menu in list
                    tr.odd.gradeX
                      td                        
                      td  #{menu.code}                        
                      td  #{menu.name}                  
                      td
                        a.btn.default.btn-xs.balck(flag='deleteMenu', id=''+menu._id)
                          i.fa.fa-trash-o
                          |  Delete          
              